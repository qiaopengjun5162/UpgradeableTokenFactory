# å®æˆ˜ï¼šä½¿ç”¨Foundry å®ç°â¼€ä¸ªå¯å‡çº§çš„å·¥å‚åˆçº¦ UpgradeableTokenFactory

## å®è·µå¯å‡çº§åˆçº¦åŠæœ€å°ä»£ç†

æŒ‘æˆ˜ä»¥é“¸å¸å·¥å‚ä¸ºä¾‹ï¼Œ ç†è§£å¯å‡çº§åˆçº¦çš„ç¼–å†™åŠæœ€å°ä»£ç†å¦‚ä½•èŠ‚çœ Gas ã€‚

å®ç°â¼€ä¸ªå¯å‡çº§çš„å·¥å‚åˆçº¦ï¼Œå·¥å‚åˆçº¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

1. `deployInscription(string symbol, uint totalSupply, uint perMint)` ï¼Œè¯¥æ–¹æ³•ç”¨æ¥åˆ›å»º ERC20 tokenï¼Œï¼ˆæ¨¡æ‹Ÿé“­æ–‡çš„ deployï¼‰ï¼Œ symbol è¡¨ç¤º Token çš„åç§°ï¼ŒtotalSupply è¡¨ç¤ºå¯å‘è¡Œçš„æ•°é‡ï¼ŒperMint ç”¨æ¥æ§åˆ¶æ¯æ¬¡å‘è¡Œçš„æ•°é‡ï¼Œç”¨äºæ§åˆ¶`mintInscription`å‡½æ•°æ¯æ¬¡å‘è¡Œçš„æ•°é‡
2. `mintInscription(address tokenAddr)` ç”¨æ¥å‘è¡Œ ERC20 tokenï¼Œæ¯æ¬¡è°ƒç”¨ä¸€æ¬¡ï¼Œå‘è¡ŒperMintæŒ‡å®šçš„æ•°é‡ã€‚

è¦æ±‚ï¼š
â€¢ åˆçº¦çš„ç¬¬â¼€ç‰ˆæœ¬ç”¨æ™®é€šçš„ new çš„æ–¹å¼å‘è¡Œ ERC20 token ã€‚
â€¢ ç¬¬â¼†ç‰ˆæœ¬ï¼ŒdeployInscription åŠ å…¥ä¸€ä¸ªä»·æ ¼å‚æ•° price ` deployInscription(string symbol, uint totalSupply, uint perMint, uint price)` , price è¡¨ç¤ºå‘è¡Œæ¯ä¸ª token éœ€è¦æ”¯ä»˜çš„è´¹ç”¨ï¼Œå¹¶ä¸” ç¬¬â¼†ç‰ˆæœ¬ä½¿ç”¨æœ€å°ä»£ç†çš„æ–¹å¼ä»¥æ›´èŠ‚çº¦ gas çš„æ–¹å¼æ¥åˆ›å»º ERC20 tokenï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹ mintInscription çš„å®ç°ä»¥ä¾¿æ”¶å–æ¯æ¬¡å‘è¡Œçš„è´¹ç”¨ã€‚

## token çš„åˆ›å»ºå’Œå‘è¡Œä¸éœ€è¦ä»»ä½•ä¸­å¿ƒåŒ–çš„ç®¡ç†è€…

#### åœ¨æŸäº›åŒºå—é“¾é¡¹ç›®ä¸­ï¼Œ**token çš„åˆ›å»ºå’Œå‘è¡Œä¸éœ€è¦ä»»ä½•ä¸­å¿ƒåŒ–çš„ç®¡ç†è€…**ï¼Œè¿™ç§è®¾è®¡èƒŒåä½“ç°äº†åŒºå—é“¾æŠ€æœ¯çš„ä¸€äº›æ ¸å¿ƒæ€æƒ³ï¼ŒåŒ…æ‹¬å»ä¸­å¿ƒåŒ–ã€å…¬å¹³æ€§å’Œé€æ˜æ€§ã€‚

### è§£é‡Šï¼š

1. **æ²¡æœ‰ç®¡ç†å‘˜**ï¼š
   - åœ¨è¿™ç§ç³»ç»Ÿä¸­ï¼Œtoken çš„åˆ›å»ºå’Œå‘è¡Œæ˜¯é€šè¿‡æ™ºèƒ½åˆçº¦è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ²¡æœ‰ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å®ä½“ï¼ˆå¦‚ä¼ ç»Ÿé‡‘èä¸­çš„é“¶è¡Œæˆ–å…¬å¸ï¼‰æ¥å¹²é¢„æˆ–ç®¡ç†è¿™ä¸€è¿‡ç¨‹ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ç”±æ™ºèƒ½åˆçº¦ä»£ç å†³å®šçš„ï¼Œè€Œæ™ºèƒ½åˆçº¦çš„æ‰§è¡Œæ˜¯å»ä¸­å¿ƒåŒ–çš„ã€‚

2. **å…¬å¹³å‘å°„**ï¼š
   - å…¬å¹³å‘å°„ï¼ˆFair Launchï¼‰æŒ‡çš„æ˜¯æ‰€æœ‰å‚ä¸è€…åœ¨åˆ›å»ºå’Œå‘è¡Œ token æ—¶ï¼Œæ‹¥æœ‰å¹³ç­‰çš„æœºä¼šï¼Œæ²¡æœ‰ä»»ä½•äººæˆ–ç»„ç»‡å¯ä»¥é€šè¿‡ç‰¹æƒè·å¾—é¢å¤–çš„ä¼˜åŠ¿æˆ–æœºä¼šã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…æ—©æœŸæŠ•èµ„è€…æˆ–ç‰¹æƒç”¨æˆ·å¯¹ token çš„ä¸å…¬å¹³æ§åˆ¶ã€‚

3. **é“­æ–‡ç«çš„èƒŒåæ€æƒ³**ï¼š
   - è¿™ç§æ€æƒ³åæ˜ äº†åŒºå—é“¾å’Œå»ä¸­å¿ƒåŒ–æŠ€æœ¯çš„æ ¸å¿ƒç†å¿µï¼Œå³é€šè¿‡æ™ºèƒ½åˆçº¦çš„è‡ªæ‰§è¡Œæœºåˆ¶ï¼Œå»ä¸­å¿ƒåŒ–åœ°ç®¡ç† token çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è€Œå‡å°‘å¯¹ä¸­å¿ƒåŒ–æ§åˆ¶çš„ä¾èµ–ï¼Œå¢åŠ ç³»ç»Ÿçš„é€æ˜åº¦å’Œå…¬å¹³æ€§ã€‚

### å¦‚ä½•å®ç°ï¼š

1. **æ™ºèƒ½åˆçº¦**ï¼š
   - ä½¿ç”¨æ™ºèƒ½åˆçº¦è‡ªåŠ¨åŒ–åˆ›å»ºå’Œå‘è¡Œ token çš„æµç¨‹ã€‚ä¾‹å¦‚ï¼Œå‘è¡Œ ERC20 token æˆ– ERC721 NFTï¼Œå¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦å®šä¹‰å’Œæ‰§è¡Œè¿™äº›æ“ä½œã€‚

2. **å»ä¸­å¿ƒåŒ–**ï¼š
   - åœ¨æ²¡æœ‰ä¸­å¿ƒåŒ–ç®¡ç†å‘˜çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ“ä½œå’Œå†³ç­–éƒ½æ˜¯ç”±æ™ºèƒ½åˆçº¦å’ŒåŒºå—é“¾ç½‘ç»œçš„å…±è¯†æœºåˆ¶å†³å®šçš„ã€‚æ‰€æœ‰çš„åˆ›å»ºå’Œå‘è¡Œè¿‡ç¨‹éƒ½æ˜¯é€æ˜çš„ï¼Œæ‰€æœ‰å‚ä¸è€…éƒ½å¯ä»¥åœ¨åŒºå—é“¾ä¸ŠæŸ¥çœ‹ã€‚

3. **å…¬å¹³æ€§**ï¼š
   - å…¬å¹³å‘å°„å¯èƒ½æ¶‰åŠè®¾è®¡æœºåˆ¶ç¡®ä¿æ‰€æœ‰ç”¨æˆ·èƒ½å¤Ÿä»¥ç›¸åŒçš„æ¡ä»¶è·å¾— tokenã€‚ä¾‹å¦‚ï¼Œä¸é€šè¿‡ç§å‹Ÿæˆ–é¢„å”®ï¼Œè€Œæ˜¯é€šè¿‡å…¬å¼€æ‹å–æˆ–å…¶ä»–å…¬å¹³çš„åˆ†å‘æ–¹å¼è¿›è¡Œå‘è¡Œã€‚

### ç¤ºä¾‹ï¼š

- **DeFi ä»£å¸**ï¼šå¾ˆå¤šå»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰é¡¹ç›®çš„ token å‘è¡Œé‡‡ç”¨äº†å…¬å¹³å‘å°„çš„æ–¹å¼ï¼Œä¸ä¾èµ–äºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–æœºæ„ï¼Œæ‰€æœ‰äººå¯ä»¥é€šè¿‡å‚ä¸ç‰¹å®šçš„å»ä¸­å¿ƒåŒ–å¹³å°è·å¾—ä»£å¸ã€‚
  
- **NFT é¡¹ç›®**ï¼šæŸäº› NFT é¡¹ç›®ä¹Ÿå¯èƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåœ¨æ²¡æœ‰ä¸­å¿ƒåŒ–ç®¡ç†è€…çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ™ºèƒ½åˆçº¦è¿›è¡Œå…¬å¼€çš„é“¸é€ ï¼ˆmintingï¼‰å’Œåˆ†å‘ã€‚

##### token çš„åˆ›å»ºå’Œå‘è¡Œä¸éœ€è¦ç®¡ç†å‘˜ï¼Œè¿™ä¸ªæ˜¯é“­æ–‡ç«çš„èƒŒåæ€æƒ³ï¼Œæ²¡æœ‰ç®¡ç†å‘˜ï¼Œå…¬å¹³å‘å°„ã€‚

è¿™å¥è¯å¼ºè°ƒäº†å»ä¸­å¿ƒåŒ–å’Œå…¬å¹³å‘å°„åœ¨åŒºå—é“¾å’ŒåŠ å¯†è´§å¸é¡¹ç›®ä¸­çš„é‡è¦æ€§ï¼Œçªå‡ºäº†æŠ€æœ¯å¯¹ä¼ ç»Ÿç®¡ç†æ¨¡å¼çš„æŒ‘æˆ˜ã€‚

## ä»€ä¹ˆæ˜¯è™šå‡½æ•°

åœ¨ Solidity ä¸­ï¼Œè™šå‡½æ•°ï¼ˆVirtual Functionï¼‰æŒ‡çš„æ˜¯ä¸€ç§å¯ä»¥è¢«å­åˆçº¦é‡å†™çš„æ–¹æ³•ã€‚è™šå‡½æ•°æ˜¯ä¸€ç§åˆçº¦çš„å‡½æ•°å£°æ˜ï¼Œå®ƒå…è®¸åœ¨æ´¾ç”Ÿåˆçº¦ä¸­å®šä¹‰ç‰¹å®šçš„å®ç°ï¼Œè€Œä¸æ˜¯åœ¨åŸºåˆçº¦ä¸­æä¾›ä¸€ä¸ªå›ºå®šçš„å®ç°ã€‚

### è™šå‡½æ•°çš„æ¦‚å¿µ

- **è™šå‡½æ•°**ï¼šåœ¨åŸºåˆçº¦ä¸­å£°æ˜çš„å‡½æ•°ï¼Œå¯ä»¥è¢«æ´¾ç”Ÿåˆçº¦é‡å†™ä»¥æä¾›ä¸åŒçš„å®ç°ã€‚
- **è¦†ç›–**ï¼šæ´¾ç”Ÿåˆçº¦ä¸­çš„å®ç°ä¼šè¦†ç›–åŸºåˆçº¦ä¸­çš„å®ç°ã€‚

### å¦‚ä½•ä½¿ç”¨è™šå‡½æ•°

åœ¨ Solidity ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®šä¹‰å’Œä½¿ç”¨è™šå‡½æ•°ï¼š

1. **å®šä¹‰è™šå‡½æ•°**ï¼š
   åœ¨åŸºåˆçº¦ä¸­ä½¿ç”¨ `virtual` å…³é”®å­—æ ‡è®°å‡½æ•°ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°å¯ä»¥è¢«å­åˆçº¦é‡å†™ã€‚

   ```solidity
   pragma solidity ^0.8.0;
   
   contract BaseContract {
       // å£°æ˜è™šå‡½æ•°
       function getValue() public virtual pure returns (uint256) {
           return 1;
       }
   }
   ```

2. **é‡å†™è™šå‡½æ•°**ï¼š
   åœ¨æ´¾ç”Ÿåˆçº¦ä¸­ä½¿ç”¨ `override` å…³é”®å­—å®ç°è™šå‡½æ•°çš„å…·ä½“é€»è¾‘ã€‚

   ```solidity
   pragma solidity ^0.8.0;
   
   contract DerivedContract is BaseContract {
       // é‡å†™è™šå‡½æ•°
       function getValue() public override pure returns (uint256) {
           return 2;
       }
   }
   ```

### ç¤ºä¾‹è§£é‡Š

```solidity
pragma solidity ^0.8.0;

contract BaseContract {
    // å£°æ˜è™šå‡½æ•°
    function getValue() public virtual pure returns (uint256) {
        return 1;
    }
}

contract DerivedContract is BaseContract {
    // é‡å†™è™šå‡½æ•°
    function getValue() public override pure returns (uint256) {
        return 2;
    }
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼š

- `BaseContract` ä¸­çš„ `getValue()` å‡½æ•°è¢«æ ‡è®°ä¸º `virtual`ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åœ¨æ´¾ç”Ÿåˆçº¦ä¸­è¢«é‡å†™ã€‚
- `DerivedContract` ä¸­é‡å†™äº† `getValue()` å‡½æ•°ï¼Œä½¿ç”¨ `override` å…³é”®å­—è¡¨ç¤ºè¿™ä¸ªå‡½æ•°é‡å†™äº†åŸºåˆçº¦ä¸­çš„ `getValue()` å‡½æ•°ã€‚

### è™šå‡½æ•°çš„ç‰¹ç‚¹

- **å¤šæ€æ€§**ï¼šè™šå‡½æ•°å®ç°äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¤šæ€æ€§ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨ä¸åŒçš„æ´¾ç”Ÿåˆçº¦ä¸­æä¾›ä¸åŒçš„å®ç°ã€‚
- **åˆçº¦ç»§æ‰¿**ï¼šè™šå‡½æ•°ä½¿å¾—åˆçº¦çš„ç»§æ‰¿æœºåˆ¶æ›´åŠ çµæ´»ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿é“¾ä¸­çš„ä¸åŒå®ç°æ¥å®ç°å¤æ‚çš„é€»è¾‘ã€‚

### æ³¨æ„äº‹é¡¹

- **æ„é€ å‡½æ•°**ï¼šæ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°ã€‚
- **è®¿é—®æ§åˆ¶**ï¼šè™šå‡½æ•°å’Œè¦†ç›–å‡½æ•°çš„è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦å¿…é¡»ä¸€è‡´ï¼Œä¾‹å¦‚éƒ½ä¸º `public` æˆ– `external`ã€‚
- **`override` å…³é”®å­—**ï¼šæ´¾ç”Ÿåˆçº¦ä¸­é‡å†™çš„å‡½æ•°å¿…é¡»ä½¿ç”¨ `override` å…³é”®å­—æ ‡è®°ã€‚

è™šå‡½æ•°æ˜¯ Solidity åˆçº¦å¼€å‘ä¸­å®ç°çµæ´»å’Œå¯æ‰©å±•è®¾è®¡çš„é‡è¦å·¥å…·ã€‚

## ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°`delegatecall`?

- ä»£ç†åˆçº¦ï¼ˆ`Proxy Contract`ï¼‰ï¼šå°†æ™ºèƒ½åˆçº¦çš„å­˜å‚¨åˆçº¦å’Œé€»è¾‘åˆçº¦åˆ†å¼€ï¼šä»£ç†åˆçº¦ï¼ˆ`Proxy Contract`ï¼‰å­˜å‚¨æ‰€æœ‰ç›¸å…³çš„å˜é‡ï¼Œå¹¶ä¸”ä¿å­˜é€»è¾‘åˆçº¦çš„åœ°å€ï¼›æ‰€æœ‰å‡½æ•°å­˜åœ¨é€»è¾‘åˆçº¦ï¼ˆ`Logic Contract`ï¼‰é‡Œï¼Œé€šè¿‡`delegatecall`æ‰§è¡Œã€‚å½“å‡çº§æ—¶ï¼Œåªéœ€è¦å°†ä»£ç†åˆçº¦æŒ‡å‘æ–°çš„é€»è¾‘åˆçº¦å³å¯ã€‚
- EIP-2535 Diamondsï¼ˆé’»çŸ³ï¼‰ï¼šé’»çŸ³æ˜¯ä¸€ä¸ªæ”¯æŒæ„å»ºå¯åœ¨ç”Ÿäº§ä¸­æ‰©å±•çš„æ¨¡å—åŒ–æ™ºèƒ½åˆçº¦ç³»ç»Ÿçš„æ ‡å‡†ã€‚é’»çŸ³æ˜¯å…·æœ‰å¤šä¸ªå®æ–½åˆçº¦çš„ä»£ç†åˆçº¦ã€‚

### EIP-1967

https://eips.ethereum.org/EIPS/eip-1967

![image-20240728185442784](assets/image-20240728185442784.png)

## åˆçº¦å‡çº§æ–¹å¼

- é€æ˜ä»£ç†ï¼ˆTransparent Proxyï¼‰- ERC1967Proxy
- UUPSï¼ˆuniversal upgradeable proxy standardï¼‰- ERC-1822

### ERC-1822: Universal Upgradeable Proxy Standard (UUPS) 

# ![ERC-1822UUPS](https://eips.ethereum.org/assets/eip-1822/proxy-diagram.png)

https://eips.ethereum.org/EIPS/eip-1822



## ä½¿ç”¨ DelegateCall è¦æ³¨æ„çš„ç‚¹

- ##### ä»£ç†å’Œé€»è¾‘åˆçº¦çš„å­˜å‚¨å¸ƒå±€éœ€è¦ä¸€è‡´ã€‚

- ##### `delegateCall` è¿”å›å€¼

- ##### `(bool success, bytes memory returnData) = address.delegatecall(payload)`

- ##### `Bytes` éœ€è½¬åŒ–ä¸ºå…·ä½“çš„ç±»å‹

- ##### ä¸èƒ½æœ‰å‡½æ•°å†²æ’

- ##### åˆå§‹åŒ–é—®é¢˜ï¼Ÿ - å®ç°åˆçº¦ä¸­æ„é€ å‡½æ•°æ— æ•ˆ

### ERC-1167: Minimal Proxy Contract 

https://eips.ethereum.org/EIPS/eip-1167

https://github.com/optionality/clone-factory

## åˆ›å»ºé¡¹ç›®

![image-20240728173806902](assets/image-20240728173806902.png)

## é¡¹ç›®ç›®å½•

```shell
â”œâ”€â”€ script
â”‚   â”œâ”€â”€ DeployProxy.s.sol
â”‚   â”œâ”€â”€ ERC20Token.s.sol
â”‚   â”œâ”€â”€ TokenFactoryV1.s.sol
â”‚   â””â”€â”€ TokenFactoryV2.s.sol
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ ERC20Token.sol
â”‚   â”œâ”€â”€ TokenFactoryV1.sol
â”‚   â””â”€â”€ TokenFactoryV2.sol
â”œâ”€â”€ test
â”‚   â”œâ”€â”€ ERC20TokenTest.sol
â”‚   â”œâ”€â”€ TokenFactoryV1Test.sol
â”‚   â””â”€â”€ TokenFactoryV2Test.sol
```



## ä»£ç 

### `ERC20Token.sol` æ–‡ä»¶

```solidity
```

### `TokenFactoryV1.sol` æ–‡ä»¶

```solidity
```

### `TokenFactoryV2Test.sol` æ–‡ä»¶

```solidity
```





## æµ‹è¯•ä»£ç 

### `ERC20TokenTest.sol` æ–‡ä»¶

```solidity
```

### `TokenFactoryV1Test.sol` æ–‡ä»¶

```solidity
```

### `TokenFactoryV2Test.sol` æ–‡ä»¶

```solidity
```



## éƒ¨ç½²

ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² `ERC20Token`  åˆçº¦

ç¬¬äºŒæ­¥ï¼šéƒ¨ç½² `TokenFactoryV1`  åˆçº¦

ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½² `TokenFactoryV2`  åˆçº¦

ç¬¬å››æ­¥ï¼š éƒ¨ç½² `DeployUUPSProxy`  ä»£ç†åˆçº¦

### éƒ¨ç½²è„šæœ¬

#### `ERC20Token.s.sol` æ–‡ä»¶

```solidity
```

#### `TokenFactoryV1.s.sol` æ–‡ä»¶

```solidity
```

#### `TokenFactoryV2.s.sol` æ–‡ä»¶

```solidity
```





### é—®é¢˜

#### æŠ¥é”™

![image-20240728181656682](assets/image-20240728181656682.png)

![image-20240728172115753](assets/image-20240728172115753.png)

#### è§£å†³

![image-20240728172010845](assets/image-20240728172010845.png)

é—®é¢˜äºŒ

![image-20240729000025123](assets/image-20240729000025123.png)



### æµ‹è¯•è¾“å‡º

```shell
UpgradeableTokenFactory on î‚  main [!?] via ğŸ…’ base took 8.2s 
âœ forge test -vv            
[â ’] Compiling...
No files changed, compilation skipped

Ran 1 test for test/ERC20TokenTest.sol:ERC20TokenTest
[PASS] testERC20Functionality() (gas: 123304)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266

Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 1.67ms (61.00Âµs CPU time)

Ran 4 tests for test/TokenFactoryV2Test.sol:CounterTest
[PASS] testTokenFactoryV2DeployInscriptionFunctionality() (gas: 2903155)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription  msg.sender, address: 0x7c8999dC9a822c1f0Df42023113EDB4FDd543266

[PASS] testTokenFactoryV2MintInscriptionFunctionality() (gas: 3002961)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription  msg.sender, address: 0x7c8999dC9a822c1f0Df42023113EDB4FDd543266

[PASS] testTokenFactoryV2PermissionsDeployInscriptionFunctionality() (gas: 2905067)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription  msg.sender, address: 0x6CA6d1e2D5347Bfab1d91e883F1915560e09129D

[PASS] testTokenFactoryV2PermissionsMintInscriptionFunctionality() (gas: 3000572)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription  msg.sender, address: 0x6CA6d1e2D5347Bfab1d91e883F1915560e09129D

Suite result: ok. 4 passed; 0 failed; 0 skipped; finished in 2.23ms (1.95ms CPU time)

Ran 2 tests for test/Counter.t.sol:CounterTest
[PASS] testFuzz_SetNumber(uint256) (runs: 256, Î¼: 30977, ~: 31288)
[PASS] test_Increment() (gas: 31303)
Suite result: ok. 2 passed; 0 failed; 0 skipped; finished in 5.42ms (4.31ms CPU time)

Ran 5 tests for test/TokenFactoryV1Test.sol:TokenFactoryV1Test
[PASS] testTokenFactoryV1DeployInscriptionFunctionality() (gas: 2972857)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription newToken:  0x8d2C17FAd02B7bb64139109c6533b7C2b9CADb81

[PASS] testTokenFactoryV1MintInscriptionFunctionality() (gas: 3068046)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription newToken:  0x8d2C17FAd02B7bb64139109c6533b7C2b9CADb81

[PASS] testTokenFactoryV1PermissionsDeployInscriptionFunctionality() (gas: 2973252)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription newToken:  0x8d2C17FAd02B7bb64139109c6533b7C2b9CADb81

[PASS] testTokenFactoryV1PermissionsMintInscriptionFunctionality() (gas: 3065556)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266
  deployInscription newToken:  0x8d2C17FAd02B7bb64139109c6533b7C2b9CADb81

[PASS] testUpgradeability() (gas: 6337394)
Logs:
  0x7c8999dC9a822c1f0Df42023113EDB4FDd543266

Suite result: ok. 5 passed; 0 failed; 0 skipped; finished in 6.02s (6.02s CPU time)

Ran 4 test suites in 6.02s (6.03s CPU time): 12 tests passed, 0 failed, 0 skipped (12 total tests)

UpgradeableTokenFactory on î‚  main [!?] via ğŸ…’ base took 6.7s 
```



## Foundry Upgrades

### Run these commands:

```shell
forge install foundry-rs/forge-std
forge install OpenZeppelin/openzeppelin-foundry-upgrades
forge install OpenZeppelin/openzeppelin-contracts-upgradeable
```

#### Set the following in `remappings.txt`, replacing any previous definitions of these remappings:

```shell
@openzeppelin/contracts/=lib/openzeppelin-contracts-upgradeable/lib/openzeppelin-contracts/contracts/
@openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/
```

#### Configure your `foundry.toml` to enable ffi, ast, build info and storage layout:

```toml
[profile.default]
ffi = true
ast = true
build_info = true
extra_output = ["storageLayout"]
```



æ›´å¤šè¯·å‚è€ƒï¼šhttps://github.com/OpenZeppelin/openzeppelin-foundry-upgrades

## æºç 



## å‚è€ƒ

- [ERC1967Utils](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/ERC1967/ERC1967Utils.sol)
- [ERC1967Proxy](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/ERC1967/ERC1967Proxy.sol)
- [Foundry Book](https://book.getfoundry.sh/)
- https://github.com/OpenZeppelin/openzeppelin-foundry-upgrades
- https://github.com/OpenZeppelin/openzeppelin-upgrades
- https://sepolia.etherscan.io/address/0x2b25e3f0879c4f9d7dedfe5414d6e48045b2fa57#writeProxyContract
- https://github.com/OpenZeppelin/openzeppelin-contracts
- https://eips.ethereum.org/EIPS/eip-1967
- https://eips.ethereum.org/EIPS/eip-1822
- https://eips.ethereum.org/EIPS/eip-1167
- https://github.com/optionality/clone-factory